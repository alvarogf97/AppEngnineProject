<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css"
          href="{{ url_for('static', filename='bulma-calendar/dist/css/bulma-calendar.min.css') }}"/>
    <script src={{ url_for('static', filename='bulma-calendar/dist/js/bulma-calendar.min.js') }}></script>
    <title>MÃ³dulo</title>
</head>
<script>
    // Initialize all input of date type.
    const calendars = bulmaCalendar.attach('[type="date"]', options);

    // Loop on each calendar initialized
    calendars.forEach(calendar => {
        // Add listener to date:selected event
        calendar.on('date:selected', date => {
            console.log(date);
        });
    });
</script>
<body>
{% block navbar %}
    {% include "navBar.html" %}
{% endblock navbar %}

{% if user %}
    <div class="is-flex is-vcentered" style="display: flex; justify-content: center; margin-top: 50px">
        <form action="{{ url_for('save_new_campaign') }}" method="POST">
            <input type="hidden" value="{{ module.key().name() }}" name="key_module">
            <div class="columns is-vcentered">
                <div class="column has-text-centered">
                    <label class="label">Campaign Name:</label>
                </div>
                <div class="column">
                    <input class="input is-rounded is-hoverable" name="name" type="text">
                </div>
                <div class="column has-text-centered">
                    <label class="label">Campaign Date:</label>
                </div>
                <div class="column">
                    <input class="input is-rounded has-text-centered" type="date" name="date">
                </div>
                <div class="column">
                    <input class="button is-link is-fullwidth is-rounded is-outlined" type="submit"
                           value="Create Campaign"/>
                </div>
            </div>
        </form>
    </div>
{% endif %}
{% block table %}
    <div class="is-vcentered is-flex" style="display: flex; justify-content: center; margin-top: 80px">
        <table class="table is-hoverable is-striped is-fullwidth" style="width: 60%">
            <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Module</th>
                <th>User</th>
                <th>Actions</th>
            </tr>
            </thead>
            {% for campaign in campaigns %}
                <tr>
                    <td class="has-text-centered">{{ campaign.name }}</td>
                    <td class="has-text-centered">{{ campaign.date }}</td>
                    <td class="has-text-centered">{{ campaign.module.name }}</td>
                    <td class="has-text-centered">{{ campaign.user.email }}</td>
                    <td class="has-text-centered">
                        <div class="columns">
                            <div class="column">
                                <button type="button" class="button is-fullwidth is-link is-rounded is-outlined"
                                        onclick="window.location.href='{{ url_for('show_curves',campaign_key=campaign.key().name()) }}'">
                                    Show curves
                                </button>
                            </div>
                            {% if campaign.has_permits(user) %}
                                <div class="column">
                                    <form action="{{ url_for('delete_campaign') }}" method="POST">
                                        <input type="hidden" name="campaign_key" value={{ campaign.key().name() }}>
                                        <input class="button is-fullwidth is-danger is-rounded is-outlined"
                                               type="submit"
                                               value="Delete"/>
                                    </form>
                                </div>
                                <div class="column">
                                    <button class="button is-fullwidth is-warning is-rounded is-outlined" type="button"
                                            onclick="window.location.href='{{ url_for('edit_campaign',campaign_key=campaign.key().name()) }}'">
                                        Edit
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endblock table %}
<br>
{% if user %}
    <div class="is-vcentered is-flex" style="display: flex; justify-content: center; margin-top: 50px">
        <form action="{{ url_for('upload_campaign') }}" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="module_key" value={{ module.key().name() }}>
            <div class="field">
                <div class="file">
                    <label class="file-label">
                        <input class="file-input" type="file" name="file_campaigns">
                        <span class="file-cta">
                            <span class="file-icon">
                                <i class="fas fa-upload"></i>
                            </span>
                            <span class="file-label">
                                Campaign file
                            </span>
                        </span>
                    </label>
                    <input type="submit" style="margin-left: 1em" class="button is-primary" value="Add"/>
                </div>
            </div>
        </form>
    </div>
{% endif %}

{% if errors %}
    <br>
    <div class="column is-2 is-offset-5">
        <div class="notification is-danger">
            {{ errors }}
        </div>
    </div>
    <br>
{% endif %}

<hr>

{% if user %}
    <div class="container">
        <article class="media">
            <figure class="media-left">
                <p class="image is-128x128">
                    <img src="https://d1nhio0ox7pgb.cloudfront.net/_img/o_collection_png/green_dark_grey/128x128/plain/user.png">
                </p>
            </figure>
            <div class="media-content">
                <form action="{{ url_for('new_comment') }}" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="module_key" value={{ module.key().name() }}>
                    <div class="field">
                        <p class="control">
                            <textarea name="text" class="textarea" placeholder="Add a comment..."></textarea>
                        </p>
                    </div>
                    <div class="field">
                        <p class="control">
                            <button class="button" type="submit">Post comment</button>
                        </p>
                    </div>
                </form>
            </div>
        </article>
    </div>
    <hr>
{% endif %}

<div class="container">
    <h3 class="subtitle is-3">Comments</h3>
    {% for comment in module.comments %}
        <div class="notification">
            <article class="media">
                <figure class="media-left">
                    <p class="image is-64x64">
                        <img src="https://d1nhio0ox7pgb.cloudfront.net/_img/o_collection_png/green_dark_grey/128x128/plain/user.png">
                    </p>
                </figure>
                <div class="media-content">
                    <div class="content">
                        <p>
                            <strong>{{ comment.user.email }}</strong>
                            <br>
                            {{ comment.text }}
                        </p>
                    </div>
                </div>

                {% if comment.has_permits(user) %}
                    <form action="{{ url_for('delete_comment') }}" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="module_key" value={{ module.key().name() }}>
                        <input type="hidden" name="comment_key" value="{{ comment.key().name() }}">
                        <div class="media-right">
                            <button class="delete has-background-danger" type="submit"></button>
                        </div>
                    </form>
                {% endif %}
            </article>
        </div>
    {% endfor %}
</div>

</body>
</html>