<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Vista de Módulos</title>
</head>
<script>
    function weather() {
        fetch('https://api.apixu.com/v1/current.json?key=03359079f1e0462c8b3185422190901&q=malaga').then(function (res) {
            if(res.status != 200){
                document.getElementById("t").innerHTML = 'could not connect to weather api'
            }

            res.json().then(function (data) {
                document.getElementById("weather_image").src = data.current.condition.icon;
                document.getElementById("weather_time").innerHTML = data.current.condition.text;
                document.getElementById("weather_temperature").innerHTML = data.current.temp_c;
                document.getElementById("weather_wind").innerHTML = data.current.wind_kph;
                document.getElementById("weather_wind_direction").innerHTML = data.current.wind_dir;
                document.getElementById("weather_humidity").innerHTML = data.current.humidity;
            })
        });
    }
    window.onload = weather;
</script>
<body>
{% block navbar %}
    {% include "navBar.html" %}
{% endblock navbar %}

{% if user %}
    <div class="is-flex is-vcentered" style="display: flex; justify-content: center; margin-top: 50px">
        <form action="{{ url_for('create_module') }}" method="POST">
            <div class="columns is-vcentered">
                <div class="column has-text-centered">
                    <label class="label">Module Name:</label>
                </div>
                <div class="column">
                    <input class="input is-rounded is-hoverable" name="name" type="text">
                </div>
                <div class="column">
                    <input class="button is-link is-fullwidth is-rounded is-outlined" type="submit"
                           value="Create module"/>
                </div>
            </div>
        </form>
    </div>
{% endif %}

{% block table %}
    <div class="is-vcentered is-flex" style="display: flex; justify-content: center; margin-top: 80px">
    <table class="table is-hoverable is-striped is-fullwidth" style="width: 60%">
        <thead>
        <tr>
            <th class="has-text-centered">Name</th>
            <th class="has-text-centered">User</th>
            <th class="has-text-centered">Actions</th>
        </tr>
        </thead>

        {% for module in modules %}
            <tr>
                <td class="has-text-centered">{{ module.name }}</td>
                <td class="has-text-centered">{{ module.user.email }}</td>
                <td class="has-text-centered">
                    <div class="columns">
                        <div class="column">
                            <button class="button is-fullwidth is-link is-rounded is-outlined" type="button"
                                    onclick="window.location.href='{{ url_for('index_campaigns', module_key=module.key().name()) }}'">
                                Show campaigns
                            </button>
                        </div>
                        {% if module.has_permits(user) %}
                            <div class="column">
                                <form action="{{ url_for('delete_module') }}" method="POST">
                                    <input type="hidden" name="module_key" value={{ module.key().name() }}>
                                    <input class="button is-fullwidth is-danger is-rounded is-outlined" type="submit"
                                           value="Delete"/>
                                </form>
                            </div>
                            <div class="column">
                                <button class="button is-fullwidth is-warning is-rounded is-outlined" type="button"
                                        onclick="window.location.href='{{ url_for('edit_module', module_key=module.key().name()) }}'">
                                    Edit
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </td>
            </tr>
        {% endfor %}
    </table>

{% endblock table %}
{% if errors %}
    <p>{{ errors }}</p>
{% endif %}
</div>
<div class="is-vcentered is-flex" style="display: flex; justify-content: center; margin-top: 80px">
    <div class="card is-fullwidth">
      <div class="card-content">
        <p class="title" id="t">
            Current weather:
        </p>
        <div class="media">
          <div class="media-left">
              <div class="card-image">
                <figure class="image is-48x48">
                  <img src="" id="weather_image" alt="time image"/>
                </figure>
              </div>
              <p><b>Weather: </b><label id="weather_time"></label></p>
              <p><b>Temperature: </b><label id="weather_temperature"></label>º</p>
              <p><b>Wind: </b><label id="weather_wind"></label> kmh</p>
              <p><b>Wind direction: </b><label id="weather_wind_direction"></label></p>
              <p><b>Humidity: </b><label id="weather_humidity"></label></p>
          </div>
        </div>
      </div>
    </div>
</div>
</body>
</html>